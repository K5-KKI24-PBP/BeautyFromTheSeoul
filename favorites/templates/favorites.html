{% extends 'base.html' %}
{% load static %}
{% block content %}
{% include 'navbar.html' %}

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>

<div class="container">
    <header>
        <h1 class="mt-3"><i class="bi-heart-fill" style="color:#99D3FF;"></i> My Favorite Products</h1>
        <hr class="hr">
        <div class="row row-cols-auto">
            <div class="col">
                <label for="sort" class="fw-light" style="color:#656565;">Sort by:</label>
            </div>
            <div class="col-sm-4">
                <select style="border-radius:30px; background-color:#6B94B3; opacity:40%; color:white" class="form-select form-select-md" aria-label="Default select">
                    <option selected>Recently Added</option>
                    <option value="1">Price</option>
                    <option value="2">Brand</option>
                    <option value="3">Type</option>
                </select>
            </div>
        </div>
    </header>

    <br>

    <div class="row">
        {% if favorites %}
            {% for favorite in favorites %}
                <div class="col-md-4 mb-4">
                    <div class="card text-center">
                        <!-- Placeholder image or product image -->
                        <div class="product-image-placeholder" style="background-color: #f2f2f2; width: 100%; height: 250px;">
                            <img src="{{ favorite.skincare_product.image }}" alt="{{ favorite.skincare_product.product_name }}" class="img-fluid" style="object-fit: contain; width: 100%; height: 100%;">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" style="text-align: left;">{{ favorite.skincare_product.product_name }}</h5>
                            <p class="card-text" style="text-align: left;">Price: {{ favorite.skincare_product.price }}</p>
                            <p class="card-text" style="text-align: left;">Brand: {{ favorite.skincare_product.product_brand }}</p>
                            <p class="card-text" style="text-align: left;">Type: {{ favorite.skincare_product.product_type }}</p>
                            
                            <div class="d-flex justify-content-between">
                                <!-- View Button -->
                                <div style="text-align: right; margin-top:-10px">
                                    <button class="btn btn-secondary" data-toggle="modal" data-target="#productModal{{ forloop.counter }}">View</button>
                                </div>
                                <!-- Button to remove from favorites -->
                                <div style="text-align: right; margin-top: -10px;">
                                    <form method="POST" action="{% url 'favorites:remove_favorites' favorite.skincare_product.product_id %}">
                                        {% csrf_token %}
                                        <button type="submit" style="background-color: transparent; color: red;" class="btn btn-danger bi bi-x-circle-fill"></button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal for each favorite product -->
                <div class="modal fade" id="productModal{{ forloop.counter }}" tabindex="-1" role="dialog" aria-labelledby="productModalLabel{{ forloop.counter }}" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="productModalLabel{{ forloop.counter }}">{{ favorite.skincare_product.product_name }}</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <img src="{{ favorite.skincare_product.image }}" alt="{{ favorite.skincare_product.product_name }}" class="img-fluid" style="object-fit: contain; width: 100%; height: auto;">
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Brand: {{ favorite.skincare_product.product_brand }}</h5>
                                        <p style="text-align: justify;">Price: {{ favorite.skincare_product.price }}</p>
                                        <p style="text-align: justify;">{{ favorite.skincare_product.product_description }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="d-flex justify-content-center align-items-center vh-100">
                <div class="text-center">
                    <img class="centered-image" src="https://cdn-icons-png.flaticon.com/512/202/202668.png" width="40" height="40" alt="Centered Icon">
                    <p class="text-center mt-3">You do not have any favorite skincare products</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>

{% endblock content %}

{% block scripts %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function() {
        // Ensure modal is triggered correctly
        $('[data-toggle="modal"]').click(function() {
            var targetModal = $(this).data("target");
            $(targetModal).modal('show');
        });
    });
</script>

{% endblock scripts %}
